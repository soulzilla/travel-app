# Download official image of php with extansions
ARG PHP_VERSION
FROM php:${PHP_VERSION}-alpine

# Set working directory
WORKDIR /var/www

# Install dependencies
RUN apk update && apk add \
  curl

# Install extensions
RUN curl -sSLf \
        -o /usr/local/bin/install-php-extensions \
        https://github.com/mlocati/docker-php-extension-installer/releases/latest/download/install-php-extensions && \
    chmod +x /usr/local/bin/install-php-extensions

ARG INSTALL_XDEBUG=false
ARG INSTALL_PHPREDIS=false
ARG INSTALL_MYSQL=false
ARG INSTALL_ZIP=false
ARG INSTALL_GD=false

RUN set -eux; \
    extensions="pcntl opcache"; \
    if [ "$INSTALL_ZIP" = "true" ]; then \
        extensions="$extensions zip"; \
    fi; \
    if [ "$INSTALL_GD" = "true" ]; then \
        extensions="$extensions gd exif"; \
    fi; \
    if [ "$INSTALL_MYSQL" = "true" ]; then \
        extensions="$extensions pdo_mysql"; \
    fi; \
    if [ "$INSTALL_XDEBUG" = "true" ]; then \
        extensions="$extensions xdebug"; \
    fi; \
    if [ "$INSTALL_PHPREDIS" = "true" ]; then \
        extensions="$extensions redis"; \
    fi; \
    install-php-extensions $extensions

# Install composer
ARG INSTALL_COMPOSER=false
RUN if [ ${INSTALL_COMPOSER} = true ]; then \
    curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer \
;fi
